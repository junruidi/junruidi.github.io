allDataHour50 = rbind(allDataHour50_male,allDataHour50_female)
normalize=function(v){return(v/sum(v))}
allDataHour50$NormWts= normalize(allDataHour50$wtmec4yr_adj)*nrow(allDataHour50)
allDataHour50_male = subset(allDataHour50, Male == 1)
allDataHour50_male$NormWts= normalize(allDataHour50_male$wtmec4yr_adj)*nrow(allDataHour50_male)
allDataHour50_female = subset(allDataHour50, Male == 0)
allDataHour50_female$NormWts= normalize(allDataHour50_female$wtmec4yr_adj)*nrow(allDataHour50_female)
dataSvy <- svydesign(id= ~SDMVPSU, strata = ~SDMVSTRA, weights = ~NormWts,
data = allDataHour50, nest = TRUE)
myvars=c("Age","NormWts","SedW_Mins","Light_Mins","MV_Mins","MVPA_Mins")
allDataHour51_male=allDataHour50_male[myvars]
allDataHour51_female=allDataHour50_female[myvars]
View(allDataHour51_female)
View(allDataHour51_male)
View(allDataHour50_male)
View(allDataHour50_female)
m4_male <- lms(SedW_Mins,Age,data=allDataHour51_male,cent=c(5,10,25,50,75,90,95,97),weights=allDataHour51_male$NormWts)
m4_female <- lms(SedW_Mins,Age,data=allDataHour51_female,cent=c(5,10,25,50,75,90,95,97),weights=allDataHour51_female$NormWts)
rm(list = ls())
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/hr.rda")
Y = hr[,-1]
Y = scale(Y, center = T, scale = F)
pcY = prcomp(Y,center = F, scale. = F)
eigenv = pcY$rotation
score_K2 = pcY$x
rm(list = ls())
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/hr.rda")
Y = hr[,-1]
Y = scale(Y, center = T, scale = F)
pcY = prcomp(Y,center = F, scale. = F)
eigenv = pcY$rotation
score_K2 = pcY$x
rm(list = ls())
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/hr.rda")
Y = hr[,-1]
Y = scale(Y, center = T, scale = F)
pcY = prcomp(Y,center = F, scale. = F)
eigenv = pcY$rotation
score_K2 = pcY$x
pdf(file = "~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/script/round6/Age20K2.pdf")
par(mfrow=c(3,1))
for(i in 1:ncol(eigenv)){
x = eigenv[,i]
plot(x,xlab = "",ylab = "eigen vector",xaxt = "n",type = "l",main = paste("eigen vector",i))
axis(1,at = c(1,6,12,18,24))
abline( h = 0,lty=3)
}
dev.off()
save(score_K2, file = "~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/all age/score_K2.rda")
rm(list = ls())
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/cov.rda")
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/all age/score_K2.rda")
score = as.data.frame(score_K2)
surv = cbind(cov, score)
View(surv)
cov(surv$PC1,surv$PC10)
cov(surv$PC1,surv$PC2)
View(score_K2)
cov(score_K2$PC1,score_K2$PC2)
cov(score_K2$[,2],score_K2[,2])
cov(score_K2[,2],score_K2[,2])
dim(score_K2)
rm(list = ls())
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/hr.rda")
Y = hr[,-1]
Y = scale(Y, center = T, scale = F)
pcY = prcomp(Y,center = F, scale. = F)
eigenv = pcY$rotation
score_K2 = pcY$x
View(score_K2)
xx = as.data.frame(score_K2)
sum(xx$PC1^2)
cov(xx$PC1,xx$PC2)
cov(xx$PC1,xx$PC3)
cov(xx$PC1,xx$PC4)
cov(xx$PC1,xx$PC5)
cov(xx$PC1,xx$PC10)
rm(list = ls())
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/cov.rda")
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/all age/score_K2.rda")
score = as.data.frame(score_K2)
surv = cbind(cov, score)
View(score_K2)
cov(score$PC1,score$PC2)
surv$survyr = surv$permth_exm/12
include.column = which(names(surv)=="include")
c1 = subset(surv,yr==34)
d1 = subset(surv,yr==56)
library(nhanesaccel)
c2 = nhanes.accel.reweight(acceldata = c1, wave = 1, seqn.column = 1,
include.column = include.column)
d2 = nhanes.accel.reweight(acceldata = d1, wave = 2, seqn.column = 1,
include.column = include.column)
surv$wt4yr = c(c2$wtmec2yr_adj/2,d2$wtmec2yr_adj/2)
names(surv)
myvars=paste0("PC",c(1:24))
rm(list = ls())
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/cov.rda")
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/all age/score_K2.rda")
score = as.data.frame(score_K2)
surv = cbind(cov, score)
surv$survyr = surv$permth_exm/12
include.column = which(names(surv)=="include")
c1 = subset(surv,yr==34)
d1 = subset(surv,yr==56)
library(nhanesaccel)
c2 = nhanes.accel.reweight(acceldata = c1, wave = 1, seqn.column = 1,
include.column = include.column)
d2 = nhanes.accel.reweight(acceldata = d1, wave = 2, seqn.column = 1,
include.column = include.column)
surv$wt4yr = c(c2$wtmec2yr_adj/2,d2$wtmec2yr_adj/2)
myvars=c("age",paste0("PC",c(1:24)))
age_quint=surv[myvars]
View(age_quint)
library(plyr)
library(nhanesaccel)
library(gamlss)
library(jpeg)
#Reading latest NHANES data
load("~/Dropbox/Age_Activity_Paper2/Update Data and Plots v2/Data_Jiawei_09_28_2016.RData")
rm(list = ls())
load("~/Dropbox/Age_Activity_Paper2/Update Data and Plots v2/Data_Jiawei_09_28_2016.RData")
#Sedentary, Light, Moderate, Vigorous Activity Counts for Each Day (Sedentary:
# Light:  > = log(100)
# Moderate: >=  log(2020)
# Vigorous: >= log(6000))
ActCols <- colnames(allData) %in% paste("MIN",1:1440,sep="")
allData=allData[complete.cases(allData[ActCols]),]
allData$TAC_Mins=rowSums(allData[,ActCols])
allData$TLAC_Mins=rowSums(log(allData[,ActCols]+1))
allData$Light_Mins = rowSums(allData[,ActCols]>=100 & allData[,ActCols] <2020)
allData$MV_Mins=rowSums(allData[,ActCols]>=2020)
allData$SedW_Mins=allData$Sed_Mins - (1440-allData$Wear_time)
#Averaging over Days
others = subset(allData, select = c(SEQN,Light_Mins,SedW_Mins,MV_Mins))
library(dplyr)
others2 = summarise(group_by(others,SEQN),lipa = mean(Light_Mins,na.rm = T),
sed = mean(SedW_Mins,na.rm = T),
mvpa = mean(MV_Mins,na.rm = T))
infoMinCols <- grepl("Mins",colnames(allData))
avgDaily  <- by(allData[,infoMinCols], allData$SEQN, function(x){colMeans(x)})
allDataHour      <- ldply(avgDaily)
#Removing NA
allDataHour50=cbind(allData[!duplicated(allData$SEQN),3:47],allDataHour[,-1])
allDataHour50$Age=as.integer(allDataHour50$Age)
attach(allDataHour50)
X = cbind.data.frame(Age, Light_Mins, SedW_Mins, MV_Mins)
complete.cases.id = complete.cases(X)
allDataHour50 = allDataHour50[complete.cases.id,]
allDataHour50$TLAC=allDataHour50$TLAC_Mins
allDataHour50$TAC=allDataHour50$TAC_Mins
#Adjusting weights
allDataHour50.wave1 = subset(allDataHour50, wave == 1)
allDataHour50.wave2 = subset(allDataHour50, wave == 2)
allDataHour50.wave1$valid    <- 1
allDataHour50.wave1.adjusted <- nhanes.accel.reweight(acceldata = allDataHour50.wave1,  wave = 1, seqn.column = 1,
include.column = which(colnames(allDataHour50.wave1) == 'valid'))
allDataHour50.wave2$valid    <- 1
allDataHour50.wave2.adjusted <- nhanes.accel.reweight(acceldata = allDataHour50.wave2,  wave = 2, seqn.column = 1,
include.column = which(colnames(allDataHour50.wave2) == 'valid'))
allDataHour50 = rbind(allDataHour50.wave1.adjusted, allDataHour50.wave2.adjusted)
allDataHour50$wtmec4yr_adj = allDataHour50$wtmec2yr_adj/2
allDataHour50_male = subset(allDataHour50, Male == 1)
allDataHour50_male.wave1 =  subset(allDataHour50_male, wave == 1)
allDataHour50_male.wave2 =  subset(allDataHour50_male, wave == 2)
allDataHour50_male.wave1.adjusted <- nhanes.accel.reweight(acceldata = allDataHour50_male.wave1,  wave = 1, seqn.column = 1,
include.column = which(colnames(allDataHour50_male.wave1) == 'valid'))
allDataHour50_male.wave2.adjusted <- nhanes.accel.reweight(acceldata = allDataHour50_male.wave2,  wave = 2, seqn.column = 1,
include.column = which(colnames(allDataHour50_male.wave2) == 'valid'))
allDataHour50_male = rbind(allDataHour50_male.wave1.adjusted, allDataHour50_male.wave2.adjusted)
allDataHour50_male$wtmec4yr_adj = allDataHour50_male$wtmec2yr_adj/2
allDataHour50_female = subset(allDataHour50, Male == 0)
allDataHour50_female.wave1 =  subset(allDataHour50_female, wave == 1)
allDataHour50_female.wave2 =  subset(allDataHour50_female, wave == 2)
allDataHour50_female.wave1.adjusted <- nhanes.accel.reweight(acceldata = allDataHour50_female.wave1,  wave = 1, seqn.column = 1,
include.column = which(colnames(allDataHour50_female.wave1) == 'valid'))
allDataHour50_female.wave2.adjusted <- nhanes.accel.reweight(acceldata = allDataHour50_female.wave2,  wave = 2, seqn.column = 1,
include.column = which(colnames(allDataHour50_female.wave2) == 'valid'))
allDataHour50_female = rbind(allDataHour50_female.wave1.adjusted, allDataHour50_female.wave2.adjusted)
allDataHour50_female$wtmec4yr_adj = allDataHour50_female$wtmec2yr_adj/2
allDataHour50 = rbind(allDataHour50_male,allDataHour50_female)
#Normalizing Weights
normalize=function(v){return(v/sum(v))}
allDataHour50$NormWts= normalize(allDataHour50$wtmec4yr_adj)*nrow(allDataHour50)
allDataHour50_male = subset(allDataHour50, Male == 1)
allDataHour50_male$NormWts= normalize(allDataHour50_male$wtmec4yr_adj)*nrow(allDataHour50_male)
allDataHour50_female = subset(allDataHour50, Male == 0)
allDataHour50_female$NormWts= normalize(allDataHour50_female$wtmec4yr_adj)*nrow(allDataHour50_female)
dataSvy <- svydesign(id= ~SDMVPSU, strata = ~SDMVSTRA, weights = ~NormWts,
data = allDataHour50, nest = TRUE)
myvars=c("Age","NormWts","SedW_Mins","Light_Mins","MV_Mins","MVPA_Mins")
allDataHour51_male=allDataHour50_male[myvars]
allDataHour51_female=allDataHour50_female[myvars]
View(allDataHour51_male)
rm(list = ls())
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/cov.rda")
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/all age/score_K2.rda")
score = as.data.frame(score_K2)
surv = cbind(cov, score)
surv$survyr = surv$permth_exm/12
include.column = which(names(surv)=="include")
c1 = subset(surv,yr==34)
d1 = subset(surv,yr==56)
library(nhanesaccel)
c2 = nhanes.accel.reweight(acceldata = c1, wave = 1, seqn.column = 1,
include.column = include.column)
d2 = nhanes.accel.reweight(acceldata = d1, wave = 2, seqn.column = 1,
include.column = include.column)
surv$wt4yr = c(c2$wtmec2yr_adj/2,d2$wtmec2yr_adj/2)
rm(list = ls())
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/cov.rda")
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/all age/score_K2.rda")
score = as.data.frame(score_K2)
surv = cbind(cov, score)
surv$survyr = surv$permth_exm/12
include.column = which(names(surv)=="include")
c1 = subset(surv,yr==34)
d1 = subset(surv,yr==56)
library(nhanesaccel)
c2 = nhanes.accel.reweight(acceldata = c1, wave = 1, seqn.column = 1,
include.column = include.column)
d2 = nhanes.accel.reweight(acceldata = d1, wave = 2, seqn.column = 1,
include.column = include.column)
surv$wt4yr = c(c2$wtmec2yr_adj/2,d2$wtmec2yr_adj/2)
myvars=c("age","wt4yr",paste0("PC",c(1:24)))
age_quint=surv[myvars]
agePC1 <- lms(PC1,age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC1 <- lms(PC1,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC1 <- lms(PC1,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC1 <- lms(PC1,age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC2 <- lms(PC2,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC3 <- lms(PC3,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC4 <- lms(PC4,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC5 <- lms(PC5,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC6 <- lms(PC6,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC7 <- lms(PC7,families=c("NO","ZAGA"),Age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC7 <- lms(PC7,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC8 <- lms(PC8,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC9 <- lms(PC9,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC10 <- lms(PC10,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC11 <- lms(PC11,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC12 <- lms(PC12,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC13 <- lms(PC13,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC14 <- lms(PC14,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
mar.default <- c(5,4,4,2) + 0.1
par(mar = mar.default + c(0, 4, 0, 0))
par(mfrow = c(1,1))
View(age_quint)
age_quint$age = as.integer(age_quint$age)
rm(list = ls())
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/cov.rda")
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/all age/score_K2.rda")
score = as.data.frame(score_K2)
surv = cbind(cov, score)
surv$survyr = surv$permth_exm/12
include.column = which(names(surv)=="include")
c1 = subset(surv,yr==34)
d1 = subset(surv,yr==56)
library(nhanesaccel)
c2 = nhanes.accel.reweight(acceldata = c1, wave = 1, seqn.column = 1,
include.column = include.column)
d2 = nhanes.accel.reweight(acceldata = d1, wave = 2, seqn.column = 1,
include.column = include.column)
surv$wt4yr = c(c2$wtmec2yr_adj/2,d2$wtmec2yr_adj/2)
myvars=c("age","wt4yr",paste0("PC",c(1:24)))
age_quint=surv[myvars]
age_quint$age = as.integer(age_quint$age)
agePC1 <- lms(PC1,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC2 <- lms(PC2,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC3 <- lms(PC3,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC4 <- lms(PC4,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC5 <- lms(PC5,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC6 <- lms(PC6,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC7 <- lms(PC7,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC8 <- lms(PC8,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC9 <- lms(PC9,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
mar.default <- c(5,4,4,2) + 0.1
par(mar = mar.default + c(0, 4, 0, 0))
par(mfrow = c(1,1))
centiles(ylab="PC1",main="",panel.first={axis(1,c(6,11,19,30,59,84),cex.axis=1.5,lab=c("6","11","19","30","59","84"),mgp=c(3,0.2,0),padj=1,tick=T,las=1)
# abline(h=seq(50,600,len=23), col="lightgrey", lty=3, lwd=3)
#
# lines(c(6,6),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(11,11),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(19,19),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(30,30),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(59,59),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(84,84),c(0,650),col="lightgrey",lty="dotted",lwd=3)
}
,xlab="Age",cex.lab=2,cex.axis=1.5,xaxt="n",agePC1,xvar=age_quint$age,cent=c(5,10,25,50,75,90,95),points=FALSE,lty.centiles=c(1),lwd=4,col="Black",legend=FALSE)
mar.default <- c(5,4,4,2) + 0.1
par(mar = mar.default + c(0, 4, 0, 0))
par(mfrow = c(1,1))
centiles(ylab="PC1",main="",panel.first={axis(1,c(20,30,40,50,60,70,80),cex.axis=1.5,lab=c("20","30","40","50","60","70",80),mgp=c(3,0.2,0),padj=1,tick=T,las=1)
# abline(h=seq(50,600,len=23), col="lightgrey", lty=3, lwd=3)
#
# lines(c(6,6),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(11,11),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(19,19),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(30,30),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(59,59),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(84,84),c(0,650),col="lightgrey",lty="dotted",lwd=3)
}
,xlab="Age",cex.lab=2,cex.axis=1.5,xaxt="n",agePC1,xvar=age_quint$age,cent=c(5,10,25,50,75,90,95),points=FALSE,lty.centiles=c(1),ylim=c(1e-05,1e05),lwd=4,col="Black",legend=FALSE)
mar.default <- c(5,4,4,2) + 0.1
par(mar = mar.default + c(0, 4, 0, 0))
par(mfrow = c(1,1))
centiles(ylab="PC1",main="",panel.first={axis(1,c(20,30,40,50,60,70,80),cex.axis=1.5,lab=c("20","30","40","50","60","70",80),mgp=c(3,0.2,0),padj=1,tick=T,las=1)
# abline(h=seq(50,600,len=23), col="lightgrey", lty=3, lwd=3)
#
# lines(c(6,6),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(11,11),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(19,19),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(30,30),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(59,59),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(84,84),c(0,650),col="lightgrey",lty="dotted",lwd=3)
}
,xlab="Age",cex.lab=2,cex.axis=1.5,xaxt="n",agePC1,xvar=age_quint$age,cent=c(5,10,25,50,75,90,95),points=FALSE,lty.centiles=c(1),ylim=c(-1e05,1e05),lwd=4,col="Black",legend=FALSE)
centiles(ylab="PC2",main="",panel.first={axis(1,c(20,30,40,50,60,70,80),cex.axis=1.5,lab=c("20","30","40","50","60","70",80),mgp=c(3,0.2,0),padj=1,tick=T,las=1)
# abline(h=seq(50,600,len=23), col="lightgrey", lty=3, lwd=3)
#
# lines(c(6,6),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(11,11),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(19,19),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(30,30),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(59,59),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(84,84),c(0,650),col="lightgrey",lty="dotted",lwd=3)
}
,xlab="Age",cex.lab=2,cex.axis=1.5,xaxt="n",agePC2,xvar=age_quint$age,cent=c(5,10,25,50,75,90,95),points=FALSE,lty.centiles=c(1),ylim=c(-1e05,1e05),lwd=4,col="Black",legend=FALSE)
centiles(ylab="PC3",main="",panel.first={axis(1,c(20,30,40,50,60,70,80),cex.axis=1.5,lab=c("20","30","40","50","60","70",80),mgp=c(3,0.2,0),padj=1,tick=T,las=1)
# abline(h=seq(50,600,len=23), col="lightgrey", lty=3, lwd=3)
#
# lines(c(6,6),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(11,11),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(19,19),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(30,30),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(59,59),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(84,84),c(0,650),col="lightgrey",lty="dotted",lwd=3)
}
,xlab="Age",cex.lab=2,cex.axis=1.5,xaxt="n",agePC3,xvar=age_quint$age,cent=c(5,10,25,50,75,90,95),points=FALSE,lty.centiles=c(1),ylim=c(-1e05,1e05),lwd=4,col="Black",legend=FALSE)
centiles(ylab="PC3",main="",panel.first={axis(1,c(20,30,40,50,60,70,80),cex.axis=1.5,lab=c("20","30","40","50","60","70",80),mgp=c(3,0.2,0),padj=1,tick=T,las=1)
# abline(h=seq(50,600,len=23), col="lightgrey", lty=3, lwd=3)
#
# lines(c(6,6),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(11,11),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(19,19),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(30,30),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(59,59),c(0,650),col="lightgrey",lty="dotted",lwd=3)
# lines(c(84,84),c(0,650),col="lightgrey",lty="dotted",lwd=3)
}
,xlab="Age",cex.lab=2,cex.axis=1.5,xaxt="n",agePC3,xvar=age_quint$age,cent=c(5,10,25,50,75,90,95),points=FALSE,lty.centiles=c(1),ylim=c(-5e04,5e04),lwd=4,col="Black",legend=FALSE)
rm(list = ls())
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/hr50.rda")
Y = hr50[,-1]
Y = scale(Y, center = T, scale = F)
pcY = prcomp(Y,center = F, scale. = F)
eigenv = pcY$rotation
score_K2 = pcY$x
View(Y)
paste0("PC",1)
rm(list = ls())
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/cov.rda")
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/all age/score_K2.rda")
score = as.data.frame(score_K2)
surv = cbind(cov, score)
surv$survyr = surv$permth_exm/12
include.column = which(names(surv)=="include")
c1 = subset(surv,yr==34)
d1 = subset(surv,yr==56)
library(nhanesaccel)
c2 = nhanes.accel.reweight(acceldata = c1, wave = 1, seqn.column = 1,
include.column = include.column)
d2 = nhanes.accel.reweight(acceldata = d1, wave = 2, seqn.column = 1,
include.column = include.column)
surv$wt4yr = c(c2$wtmec2yr_adj/2,d2$wtmec2yr_adj/2)
myvars=c("age","wt4yr",paste0("PC",c(1:24)))
age_quint=surv[myvars]
age_quint$age = as.integer(age_quint$age)
x = paste0("PC",1)
age_quint$x
agePC1 <- lms(PC1,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC1$mu.x
agePC1$fits
?lms
agePC1$y
View(age_quint)
View(c1)
rm(list = ls())
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/cov.rda")
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/all age/score_K2.rda")
score = as.data.frame(score_K2)
surv = cbind(cov, score)
surv$survyr = surv$permth_exm/12
include.column = which(names(surv)=="include")
c1 = subset(surv,yr==34)
d1 = subset(surv,yr==56)
library(nhanesaccel)
c2 = nhanes.accel.reweight(acceldata = c1, wave = 1, seqn.column = 1,
include.column = include.column)
d2 = nhanes.accel.reweight(acceldata = d1, wave = 2, seqn.column = 1,
include.column = include.column)
surv$wt4yr = c(c2$wtmec2yr_adj/2,d2$wtmec2yr_adj/2)
View(c2)
myvars=c("age","wt4yr",paste0("PC",c(1:24)))
age_quint=surv[myvars]
age_quint$age = as.integer(age_quint$age)
agePC1 <- lms(PC1,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC1$mu.fv
agePC1$mu.lp
max(agePC1$mu.lp)
1.2e4
agePC1$mu.coefficients
rm(list = ls())
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/cov.rda")
load("~/Dropbox/Junrui Di/MAMC/tensor decompostion analysis/data/round6/all age/score_K2.rda")
score = as.data.frame(score_K2)
surv = cbind(cov, score)
surv$survyr = surv$permth_exm/12
include.column = which(names(surv)=="include")
c1 = subset(surv,yr==34)
d1 = subset(surv,yr==56)
library(nhanesaccel)
c2 = nhanes.accel.reweight(acceldata = c1, wave = 1, seqn.column = 1,
include.column = include.column)
d2 = nhanes.accel.reweight(acceldata = d1, wave = 2, seqn.column = 1,
include.column = include.column)
surv$wt4yr = c(c2$wtmec2yr_adj/2,d2$wtmec2yr_adj/2)
myvars=c("age","wt4yr",paste0("PC",c(1:24)))
age_quint=surv[myvars]
age_quint$age = as.integer(age_quint$age)
agePC1 <- lms(PC1,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC2 <- lms(PC2,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC3 <- lms(PC3,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC4 <- lms(PC4,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC5 <- lms(PC5,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC6 <- lms(PC6,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC7 <- lms(PC7,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC8 <- lms(PC8,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC9 <- lms(PC9,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC10 <- lms(PC10,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC11 <- lms(PC11,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC12 <- lms(PC12,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC13 <- lms(PC13,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC14 <- lms(PC14,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC15 <- lms(PC15,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC16 <- lms(PC16,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC17 <- lms(PC17,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC18 <- lms(PC18,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC19 <- lms(PC19,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC20 <- lms(PC20,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC21 <- lms(PC21,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC22 <- lms(PC22,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC23 <- lms(PC23,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
agePC24 <- lms(PC24,families=c("NO","ZAGA"),age,data=age_quint,cent=c(5,10,25,50,75,90,95,97),weights=age_quint$wt4yr)
centiles(ylab="PC4",main="",panel.first={axis(1,c(20,30,40,50,60,70,80),cex.axis=1.5,lab=c("20","30","40","50","60","70",80),mgp=c(3,0.2,0),padj=1,tick=T,las=1)}
,xlab="Age",cex.lab=2,cex.axis=1.5,xaxt="n",agePC3,xvar=age_quint$age,cent=c(5,10,25,50,75,90,95),points=FALSE,lty.centiles=c(1),ylim=c(-5e04,5e04),lwd=4,col="Black",legend=FALSE)
centiles(ylab="PC4",main="",panel.first={axis(1,c(20,30,40,50,60,70,80),cex.axis=1.5,lab=c("20","30","40","50","60","70",80),mgp=c(3,0.2,0),padj=1,tick=T,las=1)}
,xlab="Age",cex.lab=2,cex.axis=1.5,xaxt="n",agePC4,xvar=age_quint$age,cent=c(5,10,25,50,75,90,95),points=FALSE,lty.centiles=c(1),ylim=c(-5e04,5e04),lwd=4,col="Black",legend=FALSE)
centiles(ylab="PC5",main="",panel.first={axis(1,c(20,30,40,50,60,70,80),cex.axis=1.5,lab=c("20","30","40","50","60","70",80),mgp=c(3,0.2,0),padj=1,tick=T,las=1)}
,xlab="Age",cex.lab=2,cex.axis=1.5,xaxt="n",agePC3,xvar=age_quint$age,cent=c(5,10,25,50,75,90,95),points=FALSE,lty.centiles=c(1),ylim=c(-5e04,5e04),lwd=4,col="Black",legend=FALSE)
centiles(ylab="PC6",main="",panel.first={axis(1,c(20,30,40,50,60,70,80),cex.axis=1.5,lab=c("20","30","40","50","60","70",80),mgp=c(3,0.2,0),padj=1,tick=T,las=1)}
,xlab="Age",cex.lab=2,cex.axis=1.5,xaxt="n",agePC4,xvar=age_quint$age,cent=c(5,10,25,50,75,90,95),points=FALSE,lty.centiles=c(1),ylim=c(-5e04,5e04),lwd=4,col="Black",legend=FALSE)
centiles(ylab="PC5",main="",panel.first={axis(1,c(20,30,40,50,60,70,80),cex.axis=1.5,lab=c("20","30","40","50","60","70",80),mgp=c(3,0.2,0),padj=1,tick=T,las=1)}
,xlab="Age",cex.lab=2,cex.axis=1.5,xaxt="n",agePC5,xvar=age_quint$age,cent=c(5,10,25,50,75,90,95),points=FALSE,lty.centiles=c(1),ylim=c(-5e04,5e04),lwd=4,col="Black",legend=FALSE)
centiles(ylab="PC6",main="",panel.first={axis(1,c(20,30,40,50,60,70,80),cex.axis=1.5,lab=c("20","30","40","50","60","70",80),mgp=c(3,0.2,0),padj=1,tick=T,las=1)}
,xlab="Age",cex.lab=2,cex.axis=1.5,xaxt="n",agePC6,xvar=age_quint$age,cent=c(5,10,25,50,75,90,95),points=FALSE,lty.centiles=c(1),ylim=c(-5e04,5e04),lwd=4,col="Black",legend=FALSE)
#Set our working directory.
#This helps avoid confusion if our working directory is
#not our site because of other projects we were
#working on at the time.
setwd("~/Dropbox/web/junruidi.github.io/")
#render your sweet site.
rmarkdown::render_site()
# git add -A
# git commit -m "2nd commit"
# git push origin master
#Set our working directory.
#This helps avoid confusion if our working directory is
#not our site because of other projects we were
#working on at the time.
setwd("~/Dropbox/web/junruidi.github.io/")
#render your sweet site.
rmarkdown::render_site()
# git add -A
# git commit -m "2nd commit"
# git push origin master
#Set our working directory.
#This helps avoid confusion if our working directory is
#not our site because of other projects we were
#working on at the time.
setwd("~/Dropbox/web/junruidi.github.io/")
#render your sweet site.
rmarkdown::render_site()
#Set our working directory.
#This helps avoid confusion if our working directory is
#not our site because of other projects we were
#working on at the time.
setwd("~/Dropbox/web/junruidi.github.io/")
#render your sweet site.
rmarkdown::render_site()
# git add -A
# git commit -m "2nd commit"
# git push origin master
#Set our working directory.
#This helps avoid confusion if our working directory is
#not our site because of other projects we were
#working on at the time.
setwd("~/Dropbox/web/junruidi.github.io/")
#render your sweet site.
rmarkdown::render_site()
# git add -A
# git commit -m "2nd commit"
