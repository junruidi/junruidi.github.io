plot.new()
text(0.5,0.09,paste0(ondate," to ",offdate),cex=4)
for(j in 1:nrow(act)){
actj = as.numeric(act[j,])
wj = as.numeric(w[j,])
ind.nonwear = which(wj==0)
ind.wear = which(wj==1)
if (sum(actj,na.rm = T) != 0){
plot(actj,col = "deepskyblue3",pch=19,axes = F,
type = "h",,xaxt="n",xlab="",ylab="",xlim=c(1,1440))
#lines(ind.nonwear,rep(max(actj,na.rm = T),length(ind.nonwear)),col = "firebrick", type = "h", pch = 19)
abline(v = ind.wear, col = rgb(0, 191, 255, 30, maxColorValue = 255))
abline(v = ind.nonwear, col = rgb(200, 34, 34, 10, maxColorValue = 255))
}
if (sum(actj,na.rm = T) == 0){
plot(actj,col = "deepskyblue3",pch=19,axes = F,
type = "h",,xaxt="n",xlab="",ylab="",xlim=c(1,1440),ylim = c(0,1))
abline(v = ind.wear, col = rgb(0, 191, 255, 30, maxColorValue = 255))
#lines(ind.nonwear,rep(max(actj,na.rm = T),length(ind.nonwear)),col = "firebrick", type = "h", pch = 19)
abline(v = ind.nonwear, col = rgb(200, 34, 34, 10, maxColorValue = 255))
}
#axis(side = 2, at=c(0,max(actj,na.rm = T)))
axis(side = 2, cex.axis = 2)
if(j == 1){
axis(1,at=on.s,labels = on.time,col.axis = "red",cex.axis=3,line = 2.5)
}
if(j == nrow(act)){
axis(1,at=off.s,labels = off.time,col.axis = "red",cex.axis=3,line=2.5)
}
abline(v = breaks, col = "lavenderblush4")
}
axis(1, at=breaks, cex.axis = 3,labels= lab,font=2)
title(main=paste(id.i," Actigraph"),cex.main = 8,  cex.lab = 1.2,outer = T)
dev.off()
}
pdf("~/Dropbox/Junrui Di/inhealth/Actigraph/traj1-1.pdf")
for(i in 1:length(id.list)){
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
LAC = log(act+1)
TLAC = rowSums(LAC,na.rm = T)
plot(se,TLAC,type = "b",pch=19,xaxt="n",main = id.i,xlab = "date")
axis(1,at=se,labels = date)
}
dev.off()
rm(list =  setdiff(ls(),c("actigraph2","wear","id.list")))
i=1
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
date
se
wat = subset(wear,ID == id.i)
wat
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
w = as.matrix(wat[,-c(1:3)])
View(act)
View(w)
j=1
nrow(act)
se
i=1
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
LAC = log(act+1)
TLAC = rowSums(LAC,na.rm = T)
TLAc
TLAC
View(LAC)
sum(LAC[1,],na.rm = T)
plot(se,TLAC,type = "b",pch=19,xaxt="n",main = id.i,xlab = "date")
plot(se,TLAC,type = "b",pch=19,main = id.i,xlab = "date")
plot(se,TLAC,type = "b",pch=19,xaxt="n",main = id.i,xlab = "date")
rm(list =  setdiff(ls(),c("actigraph2","wear","id.list")))
i=1
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
w = as.matrix(wat[,-c(1:3)])
j=1
xx = act[j,]
xx
act[j,which(w != 1)] = mean(act[j,which(w != 1)],na.rm = T)
which(w[j,] != 1)
j=1
w[j,]
w[j,] != 1
w[j,]
w.vec = as.vector(t(w[j,]))
w.vec
which(w.vec!=1)
act[j,which(w[j,] != 1)] = mean(act[j,which(w[j,] != 1)],na.rm = T)
act[1,]
mean(act[j,which(w[j,] != 1)],na.rm = T)
mean(act[j,which(w[j,] == 1)],na.rm = T)
act[j,which(w[j,] != 1)] = mean(act[j,which(w[j,] == 1)],na.rm = T)
act[j,]
xxx = act[j,]
xxx
xxx
i=1
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
w = as.matrix(wat[,-c(1:3)])
j=1
act[j,which(w[j,] != 1)] = mean(act[j,which(w[j,] == 1)],na.rm = T)
d = data.frame(xxx,act[k,])
d = data.frame(xxx,act[j,])
View(d)
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
d = data.frame(xxx,act[j,])
View(d)
rm(list =  setdiff(ls(),c("actigraph2","wear","id.list")))
i=1
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
View(act)
act[1,]
View(mat)
mat[1,]
rm(list =  setdiff(ls(),c("actigraph2","wear","id.list")))
i=1
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
w = as.matrix(wat[,-c(1:3)])
for(j in 1:nrow(act)){
act[j,which(w[j,] != 1)] = mean(act[j,which(w[j,] == 1)],na.rm = T)
}
View(act)
which(is.na(act[1,]))
is.na(act[1,])
mean(act[j,],na.rm = T)
act[j,which(is.na(act[1,]))] = mean(act[j,],na.rm = T)
act[1,]
j
j=1
rm(list =  setdiff(ls(),c("actigraph2","wear","id.list")))
i=1
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
w = as.matrix(wat[,-c(1:3)])
j=1
for(j in 1:nrow(act)){
act[j,which(w[j,] != 1)] = mean(act[j,which(w[j,] == 1)],na.rm = T)
}
act[1,]
j=1
act[j,which(is.na(act[1,]))] = mean(act[j,],na.rm = T)
act[1,]
rm(list =  setdiff(ls(),c("actigraph2","wear","id.list")))
pdf("~/Dropbox/Junrui Di/inhealth/Actigraph/traj_impute.pdf")
for(i in 1:length(id.list)){
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
w = as.matrix(wat[,-c(1:3)])
#impute non wear time
for(j in 1:nrow(act)){
act[j,which(w[j,] != 1)] = mean(act[j,which(w[j,] == 1)],na.rm = T)
}
for(j in 1:nrow(act)){
act[j,which(is.na(act[1,]))] = mean(act[j,],na.rm = T)
}
LAC = log(act+1)
TLAC = rowSums(LAC,na.rm = T)
plot(se,TLAC,type = "b",pch=19,xaxt="n",main = id.i,xlab = "date")
axis(1,at=se,labels = date)
}
dev.off()
View(act)
View(mat)
View(act)
rm(list =  setdiff(ls(),c("actigraph2","wear","id.list")))
pdf("~/Dropbox/Junrui Di/inhealth/Actigraph/traj_impute.pdf")
for(i in 1:length(id.list)){
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
w = as.matrix(wat[,-c(1:3)])
act2 = act
#impute non wear time
for(j in 1:nrow(act2)){
act2[j,which(w[j,] != 1)] = mean(act2[j,which(w[j,] == 1)],na.rm = T)
}
for(j in 1:nrow(act2)){
act2[j,which(is.na(act2[1,]))] = mean(act2[j,],na.rm = T)
}
LAC = log(act2+1)
TLAC = rowSums(LAC,na.rm = T)
plot(se,TLAC,type = "b",pch=19,xaxt="n",main = id.i,xlab = "date")
axis(1,at=se,labels = date)
}
dev.off()
View(act)
View(act2)
View(mat)
rm(list =  setdiff(ls(),c("actigraph2","wear","id.list")))
i=1
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
w = as.matrix(wat[,-c(1:3)])
act2 = act
j=1
act2[j,which(w[j,] != 1)] = mean(act2[j,which(w[j,] == 1)],na.rm = T)
act2[j,which(is.na(act2[1,]))] = mean(act2[j,],na.rm = T)
act2[1,]
d = data.frame(d1= act2[1,],d2 = act[1,])
View(d)
sum(d$d1)
sum(log(d$d1+1))
sum(log(d$d2+1))
sum(log(d$d2+1),na.rm = )
sum(log(d$d2+1),na.rm = T)
nrow(mat)
j=5
act2[j,which(w[j,] != 1)] = mean(act2[j,which(w[j,] == 1)],na.rm = T)
act2[j,which(is.na(act2[1,]))] = mean(act2[j,],na.rm = T)
d = data.frame(d1= act2[5,],d2 = act[5,])
View(d)
View(mat)
j=5
which(w[j,] != 1)
w[j,] != 1
rm(list =  setdiff(ls(),c("actigraph2","wear","id.list")))
pdf("~/Dropbox/Junrui Di/inhealth/Actigraph/traj_impute.pdf")
for(i in 1:length(id.list)){
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
w = as.matrix(wat[,-c(1:3)])
act2 = act
#impute non wear time
for(j in 1:nrow(act2)){
act2[j,which(w[j,] != 1)] = mean(act2[j,which(w[j,] == 1)],na.rm = T)
}
for(j in 1:nrow(act2)){
act2[j,which(is.na(act2[j,]))] = mean(act2[j,],na.rm = T)
}
LAC = log(act2+1)
TLAC = rowSums(LAC,na.rm = T)
plot(se,TLAC,type = "b",pch=19,xaxt="n",main = id.i,xlab = "date")
axis(1,at=se,labels = date)
}
dev.off()
rm(list =  setdiff(ls(),c("actigraph2","wear","id.list")))
pdf("~/Dropbox/Junrui Di/inhealth/Actigraph/traj_impute.pdf")
rm(list =  setdiff(ls(),c("actigraph2","wear","id.list")))
i=2
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
w = as.matrix(wat[,-c(1:3)])
act2 = act
j=1
act2[j,which(w[j,] != 1)] = mean(act2[j,which(w[j,] == 1)],na.rm = T)
act2[j,which(is.na(act2[j,]))] = mean(act2[j,],na.rm = T)
d = data.frame(d1= act2[1,],d2 = act[1,])
View(d)
60*14
load("~/Dropbox/Junrui Di/inhealth/Actigraph/time.rda")
View(time.list)
View(d)
sum(log(d$d1+1))
sum(log(d$d2+1))
sum(log(d$d2+1),na.rm = T)
rm(list =  setdiff(ls(),c("actigraph2","wear","id.list")))
pdf("~/Dropbox/Junrui Di/inhealth/Actigraph/traj_impute.pdf")
for(i in 1:length(id.list)){
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
w = as.matrix(wat[,-c(1:3)])
act2 = act
#impute non wear time
for(j in 1:nrow(act2)){
act2[j,which(w[j,] != 1)] = mean(act2[j,which(w[j,] == 1)],na.rm = T)
}
for(j in 1:nrow(act2)){
act2[j,which(is.na(act2[j,]))] = mean(act2[j,],na.rm = T)
}
LAC = log(act2+1)
TLAC = rowSums(LAC,na.rm = T)
plot(se,TLAC,type = "b",pch=19,xaxt="n",main = id.i,xlab = "date")
axis(1,at=se,labels = date)
}
dev.off()
rm(list =  setdiff(ls(),c("actigraph2","wear","id.list")))
pdf("~/Dropbox/Junrui Di/inhealth/Actigraph/traj_impute2.pdf")
for(i in 1:length(id.list)){
id.i = id.list[i]
print(id.i)
mat = subset(actigraph2,ID == id.i)
date = as.character(mat$Date)
se = mat$SEQN
wat = subset(wear,ID == id.i)
act = as.matrix(mat[,-c(1:3)])*as.matrix(wat[,-c(1:3)])
w = as.matrix(wat[,-c(1:3)])
act2 = act
#impute non wear time
for(j in 1:nrow(act2)){
act2[j,which(w[j,] != 1)] = mean(act2[j,which(w[j,] == 1)],na.rm = T)
}
for(j in 1:nrow(act2)){
act2[j,which(is.na(act2[j,]))] = mean(act2[j,],na.rm = T)
}
LAC = log(act2+1)
TLAC = rowSums(LAC,na.rm = T)
plot(se,TLAC,type = "b",pch=19,xaxt="n",main = id.i,xlab = "date")
axis(1,at=se,labels = date)
}
dev.off()
rm(list = ls())
database = read.csv("~/Box Sync/inHealth Mobility Pilot/plots and databases/inHealthdatabase.csv")
id.list = as.character(unique(database$ID))
rm(database)
id.list
setwd("~/Dropbox/Junrui Di/inhealth/Actigraph/")
file = read.csv("Monitor on-off times.csv",skip = 1)
View(file)
onoff = file[,c(1:5)]
charge = file[,c(1,10:12)]
View(onoff)
View(charge)
names(onoff) = c("ID","dateon","timeon","dateoff","timeoff")
names(charge) = c("ID","date","timeoff","timeon")
onoff$ID[which(nchar(onoff$ID)==1)] = paste0("iH_00",onoff$ID[which(nchar(onoff$ID)==1)])
onoff$ID[which(nchar(onoff$ID)==2)] = paste0("iH_0",onoff$ID[which(nchar(onoff$ID)==2)])
charge$ID[which(nchar(charge$ID)==1)] = paste0("iH_00",charge$ID[which(nchar(charge$ID)==1)])
charge$ID[which(nchar(charge$ID)==2)] = paste0("iH_0",charge$ID[which(nchar(charge$ID)==2)])
View(charge)
View(onoff)
onoff = subset(onoff,ID %in% id.list)
onoff$timeon = as.character(onoff$timeon)
onoff$timeon[which(nchar(onoff$timeon)==4)] = paste0("0",onoff$timeon[which(nchar(onoff$timeon)==4)])
onoff$timeoff = as.character(onoff$timeoff)
onoff$timeoff[which(nchar(onoff$timeoff)==4)] = paste0("0",onoff$timeoff[which(nchar(onoff$timeoff)==4)])
View(onoff)
charge = subset(charge,ID %in% id.list)
charge$timeoff = tolower(charge$timeoff)
charge$timeoff = gsub("[a-z]","",charge$timeoff)
charge$timeoff = gsub(" ","",charge$timeoff)
charge$timeoff[which(nchar(charge$timeoff)==4)] = paste0("0",charge$timeoff[which(nchar(charge$timeoff)==4)])
charge$timeon = tolower(charge$timeon)
charge$timeon = gsub("[a-z]","",charge$timeon)
charge$timeon = gsub(" ","",charge$timeon)
charge$timeon[which(nchar(charge$timeon)==4)] = paste0("0",charge$timeon[which(nchar(charge$timeon)==4)])
tt = as.character(seq(as.POSIXlt("2016/1/1 00:00"), as.POSIXlt("2016/1/1 23:59"), by="1 mins"))
time.list = data.frame(t = substr(tt,12,16),s = seq(1,1440))
View(charge)
View(charge)
View(file)
View(onoff)
View(time.list)
#Set our working directory.
#This helps avoid confusion if our working directory is
#not our site because of other projects we were
#working on at the time.
setwd("~/Dropbox/web/junruidi.github.io/")
#render your sweet site.
rmarkdown::render_site()
# git add -A
# git commit -m "2nd commit"
# git push origin master
#Set our working directory.
#This helps avoid confusion if our working directory is
#not our site because of other projects we were
#working on at the time.
setwd("~/Dropbox/web/junruidi.github.io/")
#render your sweet site.
rmarkdown::render_site()
# git add -A
# git commit -m "2nd commit"
# git push origin master
#Set our working directory.
#This helps avoid confusion if our working directory is
#not our site because of other projects we were
#working on at the time.
setwd("~/Dropbox/web/junruidi.github.io/")
#render your sweet site.
rmarkdown::render_site()
# git add -A
# git commit -m "2nd commit"
# git push origin master
?rmarkdown::render_site
#Set our working directory.
#This helps avoid confusion if our working directory is
#not our site because of other projects we were
#working on at the time.
setwd("~/Dropbox/web/junruidi.github.io/")
#render your sweet site.
rmarkdown::render_site()
#Set our working directory.
#This helps avoid confusion if our working directory is
#not our site because of other projects we were
#working on at the time.
setwd("~/Dropbox/web/junruidi.github.io/")
#render your sweet site.
rmarkdown::render_site()
#Set our working directory.
#This helps avoid confusion if our working directory is
#not our site because of other projects we were
#working on at the time.
setwd("~/Dropbox/web/junruidi.github.io/")
#render your sweet site.
rmarkdown::render_site()
#Set our working directory.
#This helps avoid confusion if our working directory is
#not our site because of other projects we were
#working on at the time.
setwd("~/Dropbox/web/junruidi.github.io/")
#render your sweet site.
rmarkdown::render_site()
# git add -A
# git commit -m "2nd commit"
# git push origin master
#Set our working directory.
#This helps avoid confusion if our working directory is
#not our site because of other projects we were
#working on at the time.
setwd("~/Dropbox/web/junruidi.github.io/")
#render your sweet site.
rmarkdown::render_site()
# git add -A
# git commit -m "2nd commit"
# git push origin master
load("~/Desktop/hazardfunction.rda")
hazard_rest = hazardfunction$hazardrest
View(hazard_rest)
hazard_act = hazardfunction$hazardact
save(hazard_rest,hazard_act,file = "~/Dropbox/Junrui Di/hazard/data/hazard.rda")
rm(list = ls())
load("~/Dropbox/Junrui Di/hazard/data/hazard.rda")
library(dplyr)
hr_g = group_by(hazard_rest,by="SEQN")
hr = summarise(hr_g,nm = max(seq_r))
View(hr)
View(hazard_rest)
hr = summarise(group_by(hazard_rest,SEQN),number = n())
View(hr)
hra = summarise(group_by(hazard_act,SEQN),number = n())
View(hra)
hr = summarise(group_by(hazard_rest,SEQN),number = n())
ha = summarise(group_by(hazard_act,SEQN),number = n())
View(ha)
View(hazard_act)
